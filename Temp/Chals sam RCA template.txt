

Please provide following information to assist you with RCA, and it may take some time.

1) Node name & Exact time of node eviction

2) Environment Information

Exadata Machine Version ( V1 / V2 / X2-2 / X2-8 ) :
Exadata Rack Configuration Type ( Full / Quarter / Half ) :
Oracle Grid/RDBMS Version ( 11.2.0.1 / 11.2.0.2 / 11.2.0.3 ) :
Exadata Software version ( Output from "imageinfo" command ) :
Which exadata bundle patch ( BP Level ) has been applied ? :
List of one-off patches applied to Database and Grid Homes ? ( Output from "opatch lsinventory -details -all" ) :

3)	Opatch

cd $ORACLE_HOME/OPatch
	
./opatch -lsinventory

4)	
	
3) Please upload diagcollection.sh output files from all DB nodes.

# to know the  eviction information from cluster front.

$GRID_HOME/bin/diagcollection.sh
For diagcollection refer to CRS 10gR2/ 11gR1/ 11gR2 Diagnostic Collection Guide (Doc ID 330358.1)

# script /tmp/diag.log
# id
# env
# cd <temp-directory-with-plenty-free-space>
# $GRID_HOME/bin/diagcollection.sh
# exit  

The following .gz files will be generated in the current directory and need to be uploaded along with /tmp/diag.log: 
 
crsData_<hostname>.tar.gz,
ocrData_<hostname>.tar.gz,
oraData_<hostname>.tar.gz,
coreData_<hostname>.tar.gz (only --core option specified)
os_<hostname>.tar.gz 

4) Please upload alert.log from DB and ASM instances from all DB nodes

5) Grid home logs from all db nodes.

% cd $grid_home/log/<hostname>
% find . | xargs grep '2011-11-29' -sl

or 

cd $GRID_HOME/log
tar -cvzf node1.tar.gz *

6)  OS logs

/var/log/messages*

7) Each Instance’s LMON, LMD and LMS trace files as follows

dcli  -l root -c <list of dbnodes> 'cd /u01/app/oracle/diag/rdbms/cdx01pb ; egrep -lr '2012-09-12|Sep' * |  xargs tar cvfz /tmp/`hostname -s`-rdbms.tar.gz ; '  

Ex:
dcli  -l root -c dmorlx8db01,dmorlx8db02 "cd /u01/app/oracle/diag/rdbms/dbm ; egrep -lr '2012-09-12|Sep' * |  xargs tar cvfz /tmp/rdbms.tar.gz;"

cd /u01/app/oracle/diag/rdbms/vcmc/<SID>/trace/

egrep -l '2012-09-24 12' *.trc|grep lm
egrep -lr '2012-09-12|Sep' * |  xargs tar cvfz /tmp/`hostname -s`-rdbms.tar.gz ;

Traces generated under /u01/app/oracle/diag/rdbms/cdx01pb/CDX01PB1/trace/ for Sat Sep 15

	
	
	
	
2. provide lms*,lmd traces as follows:

 
 
 
Eg:/u01/app/oracle/diag/rdbms/<db_name>/<inst_id>/trace/

[root@exp1db01 trace]# grep '2011-09-11 05' *trc| awk -F: '{print $1}' | uniq

@ +ASM1_dia0_13099.trc
@ +ASM1_diag_13093.trc
@ +ASM1_gmon_13134.trc
@ +ASM1_lck0_13146.trc
@ +ASM1_lmon_13101.trc
@ +ASM1_ora_24162.trc
@ +ASM1_rbal_13132.trc
@ +ASM1_xdmg_13140.trc

9)  
-- Please provided stack trace from any core files generated at this time. Is a core file created in $HOME, $ORACLE_HOME/bin, $ORACLE_HOME/dbs, cdump, or current working directory? If a core file is created then follow metalink doc 1812.1 "TECH Getting a Stack Trace from a CORE file" to get stack trace from core (http://metalink.oracle.com/metalink/plsql/showdoc?db=NOT&id=1812.1).

10)Cell trace & logs

Upload logs for me please from the problem cell, covering problem time.

%  cd $ADR_BASE/diag/asm/cell/<hostname>/trace/
%  egrep -lr 2012-09-06 * | xargs tar cvfz `hostname -s`_cell_diag.tar.gz


8) Please upload the Storage Cell alert.log and Storage Cell alert history: from all cell nodes 

a.)  /opt/oracle/cell/log/diag/asm/cell/{node name}/trace/alert.log
b.)  # cellcli -l show alerthistory

9) OS watcher information:

location of logs==> /opt/oracle.oswatcher/osw/archive

cd /opt/oracle.oswatcher/osw/archive
find . -name '*12.09.05*' -exec zip /tmp/osw_`hostname -a`.zip {} \;

cd /opt/oracle.oswatcher/osw/archive - 
->Change date and time covering problem time.
find . -name "*11.10.13.1[8-9]00*" -exec zip /tmp/osw_`hostname -a`_0503.zip {} \;
-->please do not miss ';' at the last in the above command

To get OS watcher data of specific date :
cd /opt/oracle.oswatcher/osw/archive
find . -name '*12.01.13*' -print -exec zip /tmp/osw_`hostname`.zip {} \; 
where 12- year 01- Month 13-day


10) Linux OFA & kernel information

a) dcli  -l root -c <list of dbnodes> "rpm -qa | grep ofa"
b). dcli  -l root -c <list of dbnodes>  "uname -a"

11) Linux crash file information

# to check the possibility of LINUX PROBLEM

 grep path /etc/kdump.conf will give  the core file location  

Please check for a vmcore/crashcore that may have been generated during the reboot.

The cells and database servers of Oracle Exadata Database Machine are configured to generate Linux kernel crash core files when there is a Linux crash.  
Common locations are /var/crash or /u01/crashfiles on database nodes, and /var/log/oracle/crashfiles on cell nodes.

Start in this file:
cat /etc/kdump.conf
Look for the uncommented filesystem (ext3) and path.
example:
ext3 /dev/md11
path /crashfiles

The location is the /crashfiles folder from the mount point of /dev/md11.
The find where md11 is mounted:
df

example:
/dev/md11              2395452    280896   1992872  13% /var/log/oracle

Then change to that directory:
cd /var/log/oracle/crashfiles

12) Core Files
check for any corefiles generated around the timframe of crash.
If you see any please extract the stack from corefile (refer note 1812.1).

You can make use of our FTP site for easy access:
How to Send a File to Oracle Support Using FTP (ftp.oracle.com) (Doc ID 464666.1)

Let me know if you have any queries.



13) SOS report

sosreport requires root permissions to run.

# /usr/sbin/sosreport
The sosreport will run for several minutes, according to different system, the running time maybe more longer.

Once completed, “sosreport” will generate a compressed a bz2 file under /tmp.



14) Run infinicheck (from any of the compute nodes) command:


    # /opt/oracle.SupportTools/ibdiagtools/infinicheck -g /opt/oracle.SupportTools/onecommand/dbs_ib_group |tee /tmp/infinicheck_`hostname`.log

    where dbs_ib_group contains the hostnames/IPoIB of the compute nodes part of the cluster. It has to be using the IB subnet.

    Note:  The location for dbs_ib_group is for Oracle Sun DB Machine. For other systems, specify the location of the file 
	
	
Upload Options


FTP.ORACLE.COM
==============

Please see the following FTP Instructions for uploading files to our external ftp site:

FTP server:  ftp.oracle.com 
- (login: anonymous / guest)
- cd /support/incoming
- mkdir <your full SR number>
- cd <your SR#>
- Change transfer mode: bin or ascii (For zip or other binary files, please use binary mode, and for text files such as .ora, .log, or .trc use ASCII mode)
- mput * or <filename>

(Special Note: If using the FTP site to provide files, please be sure to update the SR via My Oracle Support to let Support know the files have been uploaded.)

More Information
How to Send a File to Oracle Support Using FTP (ftp.oracle.com) (Doc ID 464666.1)
Note 77483.1 'External Support FTP site: Information Sheet'


SUN Support File Transfer Service
==================================

Step 1 Go to https://supportfiles.sun.com/upload
Step 2 Choose the file you wish to upload. 
Step 3 Select a destination "Core" for this file
Step 4 Enter a Case Number eg. 3-6257778521 for this file 
Step 5 Upload your file
Step 6 If an upload has successfully completed, you should see the following message on your display:

"Thanks for your upload. Your file has been stored as on the Supportfiles service."



Thank you for your patience.
Jee
Engineered Systems Support
Supporting Exadata, SuperCluster, Database Appliance 







@ Repeat the following at interval of 10 minutes for 2 hours to collect evidence:
@ 
@ On Linux:
@ 1. pmap -d <pid_of_agent>
@ 2. pstack <pid_of_agent>
@ 3. ps -fL -p <pid_of_agent> | wc -l




Please upload the following logs to investigate further .

+  $./diagcollection.pl -collect

Note.330358.1 CRS 10gR2/ 11gR1/ 11gR2 Diagnostic Collection Guide
RAC: Frequently Asked Questions (INTERNAL ONLY) (Doc ID 200346.1)

# script /tmp/diag.log
# id
# env
# cd <temp-directory-with-plenty-free-space>
# $GRID_HOME/bin/diagcollection.sh
# exit  

The following .gz files will be generated in the current directory and need to be uploaded along with /tmp/diag.log: 
 
crsData_<hostname>.tar.gz,
ocrData_<hostname>.tar.gz,
oraData_<hostname>.tar.gz,
coreData_<hostname>.tar.gz (only --core option specified)
os_<hostname>.tar.gz 


Diagnostic / Data Collection Tools
--------------------------------------------------------------------
Exadata Diagnostic Collection Guide (Doc ID 1353073.1)
  Topic:  RAC Instance or node Evictions
    Use option 2 to collect the target date of the incident.


+  Oswatcher logs

cd /opt/oracle.oswatcher/osw/archive
find . -name '*12.10.12* -print -exec zip  /tmp/osw_`hostname`.zip {} \;


Each Instance’s LMON, LMD and LMS trace files as follows

dcli  -l root -c <list of dbnodes> 'cd /u01/app/oracle/diag/rdbms/fms ; egrep -lr '2012-10-12|Sep' * |  xargs tar cvfz /tmp/`hostname -s`-rdbms.tar.gz ; '  

Ex:
dcli  -l root -c dmorlx8db01,dmorlx8db02 "cd /u01/app/oracle/diag/rdbms/dbm ; egrep -lr '2012-09-12|Sep' * |  xargs tar cvfz /tmp/rdbms.tar.gz;"


 provide lms*,lmd traces as follows:

 cd /u01/app/oracle/diag/rdbms/vcmc/<SID>/trace/

egrep -l '2012-10-12 22' *.trc|grep lm
egrep -lr '2012-10-12|Sep' * |  xargs tar cvfz /tmp/`hostname -s`-rdbms.tar.gz ;


Best Regards,

Siddhartha
